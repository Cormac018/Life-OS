<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Personal life tracking and goal management system" />
    <meta name="theme-color" content="#4f8cff" />
    <title>Life OS</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="./icon-512.png" />
    <link rel="icon" type="image/svg+xml" href="./logo.svg" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="./manifest.json" />

    <!-- iOS Support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Life OS" />
    <link rel="apple-touch-icon" href="./icon-192.png" />

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Life OS Top Nav -->
    <nav class="lifeos-nav" aria-label="Life OS navigation">
      <a href="#today" data-route="today">Today</a>
      <a href="#workouts" data-route="workouts">Health</a>
      <a href="#metrics" data-route="metrics">Metrics</a>
      <a href="#goals" data-route="goals">Goals</a>
      <a href="#plan" data-route="plan">Plan</a>
      <a href="#work" data-route="work">Work</a>
      <a href="#finances" data-route="finances">Finances</a>
      <a href="#journal" data-route="journal">Journal</a>
      <a href="#people" data-route="people">People</a>
    </nav>

    <main class="lifeos-main">
      <!-- Placeholder views -->
    <section id="view-today" class="lifeos-view">
  <h1 class="app-title">Today</h1>

  <!-- Goals summary -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Active goals</h2>
    <div id="todayGoals"></div>
  </div>
<!-- Diet summary (Swipeable Card) -->
<div id="todayDietCard" class="dashboard-card" style="margin-top:12px;">
  <!-- Content populated by today.js -->
</div>

  <!-- Plan for today (Swipeable Card) -->
  <div id="todayPlanCard" class="dashboard-card" style="margin-top:12px;">
    <!-- Content populated by today.js -->
  </div>

  <!-- Work (Swipeable Card) -->
  <div id="todayWorkCard" class="dashboard-card" style="margin-top:12px;">
    <!-- Content populated by today.js -->
  </div>

  <!-- Life OS Data (export/import) -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Life OS Data</h2>

    <div class="btn-row">
      <button id="lifeosExportBtn" type="button">Export Life OS</button>

      <label class="btn-file">
        Import Life OS
        <input id="lifeosImportInput" type="file" accept="application/json" />
      </label>
    </div>

    <div id="lifeosImportStatus" style="margin-top:10px; color:var(--muted); font-size:13px;"></div>

    <p style="margin-top:12px; color:var(--muted); font-size:13px;">
      This export/import is for Life OS modules (Goals, Metrics, Plan, People, etc.). Your workout app export/import remains unchanged.
    </p>
  </div>
</section>

      <!-- Workouts view (your existing app unchanged, just wrapped) -->
      <section id="view-workouts" class="lifeos-view">
       <h1 class="app-title">Health</h1>

<div class="health-tabs" aria-label="Health navigation">
  <button type="button" class="health-tab active" data-health="workout">Workout</button>
  <button type="button" class="health-tab" data-health="sleep">Sleep</button>
  <button type="button" class="health-tab" data-health="diet">Diet</button>
</div>
<div id="healthPaneWorkout" class="health-pane active">
        <div class="tabs">
          <button class="tab active" data-tab="train">Train</button>
          <button class="tab" data-tab="progress">Progress</button>
          <button
            id="themeToggle"
            type="button"
            class="tab tab--icon"
            aria-label="Toggle theme"
          >
            Theme
          </button>
        </div>

        <div id="trainTab" class="tab-content active">
          <h2 id="currentSession"></h2>
          <div class="btn-row">
            <button id="completeSessionBtn" type="button">Complete Session</button>
            <button id="logRestDayBtn" type="button">Log Rest Day</button>
          </div>

          <div id="restNotice" style="margin: 10px 0"></div>
          <div id="upperCContainer" style="display: none">
            <p><strong>Optional session available:</strong> Upper C ‚Äî Delts & Arms Pump</p>
            <button id="startUpperCBtn" type="button">Start Upper C</button>
            <button id="skipUpperCBtn" type="button">Skip Upper C</button>
          </div>

          <h3 id="workoutPlanTitle">Workout Plan</h3>
          <div id="workoutPlan"></div>

          <!-- NEW: dock where the log form lives when no card is selected -->
          <div id="logFormDock"></div>

          <form id="logForm">
            <!-- Pattern -->
            <label>
              Pattern
              <select id="pattern">
                <option value="incline_press">Incline Press</option>
                <option value="horizontal_pull">Horizontal Pull</option>
                <option value="vertical_pull">Vertical Pull</option>
                <option value="lateral_raise">Lateral Raise</option>
                <option value="rear_delt">Rear Delt / Face Pull</option>
                <option value="vertical_press">Vertical Press</option>
                <option value="triceps">Triceps</option>
                <option value="biceps">Biceps</option>
                <option value="knee_dominant">Knee-Dominant (Quads)</option>
                <option value="single_leg_quad">Single-Leg Quads</option>
                <option value="hip_hinge">Hip Hinge</option>
                <option value="glute_unilateral">Glute-Biased Unilateral</option>
                <option value="hamstring_accessory">Hamstring Accessory</option>
                <option value="calves">Calves</option>
                <option value="core">Core (Abs)</option>
              </select>
            </label>

            <!-- Variant -->
            <label>
              Variant (select or type)
              <select id="variantSelect"></select>
            </label>

            <label id="variantCustomLabel" style="display: none">
              Custom variant
              <input type="text" id="variantCustom" placeholder="Type your variant name" />
            </label>

            <!-- Weight -->
            <label>
              Weight (kg)
              <input type="number" id="weight" required />
            </label>

            <!-- Reps -->
            <label>
              Reps
              <input type="number" id="reps" required />
            </label>

            <button type="submit">Save Set</button>
          </form>

          <h2 id="historyTitle">History (All Patterns)</h2>
          <div id="summary"></div>
          <ul id="history"></ul>

          <div class="btn-row">
            <button id="backBtn" type="button" style="display: none">Back</button>
            <button id="exportDataBtn" type="button">Export data</button>

            <label class="btn-file">
              Import data
              <input id="importDataInput" type="file" accept="application/json" />
            </label>

            <button id="clearAll" type="button">Clear all data</button>
          </div>
        </div>

        <div id="progressTab" class="tab-content">
          <h2>Progress</h2>

          <div style="margin-bottom: 16px;">
            <label style="display: block; margin-bottom: 12px;">
              <span style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: var(--muted);">Tracking Mode</span>
              <select id="progressTrackingMode" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid var(--border); border-radius: 8px;">
                <option value="by-slot">By Workout Day (e.g., Upper A - Incline Press)</option>
                <option value="by-pattern">By Lift Type (e.g., All Incline Press)</option>
              </select>
            </label>

            <div id="progressBySlotControls">
              <label style="display: block; margin-bottom: 12px;">
                <span style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: var(--muted);">Exercise Slot</span>
                <select id="progressExerciseSelect" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid var(--border); border-radius: 8px;"></select>
              </label>

              <label style="display: block; margin-bottom: 12px;">
                <span style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: var(--muted);">Variant Filter</span>
                <select id="progressVariantSelect" disabled style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid var(--border); border-radius: 8px;">
                  <option value="">All variants</option>
                </select>
              </label>
            </div>

            <div id="progressByPatternControls" style="display: none;">
              <label style="display: block; margin-bottom: 12px;">
                <span style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: var(--muted);">Lift Type</span>
                <select id="progressPatternSelect" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid var(--border); border-radius: 8px;"></select>
              </label>

              <label style="display: block; margin-bottom: 12px;">
                <span style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 600; color: var(--muted);">Variant Filter</span>
                <select id="progressPatternVariantSelect" style="width: 100%; padding: 10px; font-size: 14px; border: 1px solid var(--border); border-radius: 8px;">
                  <option value="">All variants</option>
                </select>
              </label>
            </div>
          </div>

          <!-- Swipeable Progress Tabs -->
          <div class="dashboard-card" style="margin-top: 16px;">
            <div class="dashboard-tabs">
              <button class="dashboard-tab active" data-progress-tab="summary">Summary</button>
              <button class="dashboard-tab" data-progress-tab="chart">Chart</button>
              <button class="dashboard-tab" data-progress-tab="history">History</button>
            </div>
            <div class="dashboard-content-container" id="progressContentContainer">
              <!-- Summary Panel -->
              <div class="dashboard-content-panel active" data-progress-panel="summary">
                <div id="progressSummary"></div>
              </div>

              <!-- Chart Panel -->
              <div class="dashboard-content-panel" data-progress-panel="chart">
                <div id="progressChartWrap" style="padding: 14px">
                  <canvas
                    id="progressChart"
                    width="700"
                    height="260"
                    style="width: 100%; height: 260px; display: block"
                  ></canvas>
                  <div
                    id="progressChartHint"
                    style="margin-top: 10px; color: var(--muted); font-size: 13px"
                  ></div>
                </div>
              </div>

              <!-- History Panel -->
              <div class="dashboard-content-panel" data-progress-panel="history">
                <div id="progressTable"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="healthPaneSleep" class="health-pane">
  <h2 style="margin-top:0;">Sleep</h2>
  <div class="sleep-tabs" aria-label="Sleep navigation">
    <button type="button" class="sleep-tab active" data-sleep="log">Log</button>
    <button type="button" class="sleep-tab" data-sleep="progress">Progress</button>
  </div>

  <div id="sleepPaneLog" class="sleep-pane active">
    <!-- Summary Cards -->
    <div style="display:flex; gap:12px; flex-wrap:wrap; margin:12px 0;">
      <div class="revolut-card" style="flex:1; min-width:160px; padding:16px;">
        <div style="color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px;">Last Night</div>
        <div id="sleepLastNight" style="font-weight:700; font-size:20px; background:linear-gradient(135deg, #4f8cff 0%, #7aa7ff 100%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;">‚Äî</div>
      </div>

      <div class="revolut-card" style="flex:1; min-width:160px; padding:16px;">
        <div style="color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:0.5px; margin-bottom:8px;">Current Streak</div>
        <div id="sleepCurrentStreak" style="font-weight:700; font-size:20px; color:#22c55e;">‚Äî</div>
      </div>
    </div>

    <!-- Log Sleep Form -->
    <div class="revolut-card" style="margin:12px 0; padding:20px;">
      <div style="font-size:16px; font-weight:700; margin-bottom:16px; color:var(--text);">Log Sleep</div>
      <form id="sleepForm" style="display:flex; flex-direction:column; gap:14px;">
        <label style="display:flex; flex-direction:column; gap:6px;">
          <span style="font-size:13px; font-weight:600; color:var(--muted);">Date</span>
          <input type="date" id="sleepDate" required style="padding:12px; font-size:15px; border:1px solid var(--border); border-radius:8px; background:var(--surface-2); color:var(--text);" />
        </label>

        <label style="display:flex; flex-direction:column; gap:6px;">
          <span style="font-size:13px; font-weight:600; color:var(--muted);">Duration (hours)</span>
          <input type="number" id="sleepHours" step="0.1" min="0" max="24" required placeholder="e.g., 7.5" style="padding:12px; font-size:15px; border:1px solid var(--border); border-radius:8px; background:var(--surface-2); color:var(--text);" />
        </label>

        <label style="display:flex; flex-direction:column; gap:6px;">
          <span style="font-size:13px; font-weight:600; color:var(--muted);">Quality (1-100)</span>
          <input type="number" id="sleepQuality" step="1" min="1" max="100" required placeholder="e.g., 85" style="padding:12px; font-size:15px; border:1px solid var(--border); border-radius:8px; background:var(--surface-2); color:var(--text);" />
        </label>

        <button type="submit" style="padding:14px; font-size:15px; font-weight:600; border-radius:8px; border:none; background:linear-gradient(135deg, var(--accent) 0%, rgba(122,167,255,1) 100%); color:white; cursor:pointer; margin-top:6px;">Add Sleep Entry</button>
      </form>
    </div>

    <!-- Sleep History List -->
    <div style="margin:12px 0;">
      <ul id="sleepList" style="list-style:none; padding:0; margin:0;"></ul>
    </div>
  </div>

  <div id="sleepPaneProgress" class="sleep-pane">
    <!-- Time Range Selector -->
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin:12px 0;">
      <button type="button" class="btn-ghost sleep-range-btn active" data-range="7">Week</button>
      <button type="button" class="btn-ghost sleep-range-btn" data-range="30">Month</button>
      <button type="button" class="btn-ghost sleep-range-btn" data-range="90">3M</button>
      <button type="button" class="btn-ghost sleep-range-btn" data-range="180">6M</button>
      <button type="button" class="btn-ghost sleep-range-btn" data-range="365">Year</button>
    </div>

    <!-- Swipeable Dashboard -->
    <div class="dashboard-card" style="margin-top:12px;">
      <div class="dashboard-tabs">
        <button class="dashboard-tab active" data-sleep-progress-tab="summary">Summary</button>
        <button class="dashboard-tab" data-sleep-progress-tab="chart">Chart</button>
        <button class="dashboard-tab" data-sleep-progress-tab="insights">Insights</button>
      </div>
      <div class="dashboard-content-container" id="sleepProgressContentContainer">
        <!-- Summary Panel -->
        <div class="dashboard-content-panel active" data-sleep-progress-panel="summary">
          <div class="revolut-card" style="padding:20px; margin-bottom:12px;">
            <div style="font-size:16px; font-weight:700; margin-bottom:16px;">Sleep Statistics</div>
            <div id="sleepAverages" style="font-size:14px; line-height:1.6;">‚Äî</div>
          </div>
          <div class="revolut-card" style="padding:20px;">
            <div style="font-size:16px; font-weight:700; margin-bottom:16px;">Streaks</div>
            <div id="sleepLongestStreak" style="font-size:14px; line-height:1.6;">‚Äî</div>
          </div>
        </div>

        <!-- Chart Panel -->
        <div class="dashboard-content-panel" data-sleep-progress-panel="chart">
          <div style="padding:14px;">
            <canvas id="sleepChart" style="width:100%; height:260px; display:block; border-radius:12px;"></canvas>
          </div>
        </div>

        <!-- Insights Panel -->
        <div class="dashboard-content-panel" data-sleep-progress-panel="insights">
          <div class="revolut-card" style="padding:20px;">
            <div style="font-size:16px; font-weight:700; margin-bottom:16px;">Sleep Insights</div>
            <div id="sleepInsightsContent" style="font-size:14px; color:var(--muted); line-height:1.6;">
              Track your sleep patterns over time to identify trends and improve your sleep quality.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="healthPaneDiet" class="health-pane">
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin-top:0;">Diet</h2>

    <!-- Diet Tabs -->
    <div class="diet-tabs" role="tablist" aria-label="Diet sections">
      <button type="button" class="diet-tab is-active" data-diet-tab="plan">Plan</button>
      <button type="button" class="diet-tab" data-diet-tab="log">Log</button>
      <button type="button" class="diet-tab" data-diet-tab="progress">Progress</button>
      <button type="button" class="diet-tab" data-diet-tab="prep">Prep & Shop</button>
    </div>

    <!-- PLAN TAB -->
    <div id="dietTab-plan" class="diet-tabpanel is-active" role="tabpanel">
      <!-- Goal & Targets Card -->
      <div class="dashboard-card" style="margin-top:12px;">
        <div class="dashboard-card-header">
          <div class="dashboard-card-title">üéØ Diet Goal & Targets</div>
        </div>
        <div style="padding:16px;">
          <div style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap;">
            <label style="flex:1; min-width:160px;">
              Goal
              <select id="dietPlanGoal" style="width:100%;">
                <option value="bulk">Bulk</option>
                <option value="cut">Cut</option>
                <option value="maintain">Maintain</option>
              </select>
            </label>

            <label style="flex:1; min-width:160px;">
              Calorie target (kcal)
              <input type="number" id="dietTargetCalories" min="0" step="10" placeholder="e.g. 2600" style="width:100%;" />
            </label>

            <label style="flex:1; min-width:160px;">
              Protein target (g)
              <input type="number" id="dietTargetProtein" min="0" step="1" placeholder="e.g. 180" style="width:100%;" />
            </label>

            <div style="flex:1; min-width:160px;">
              <button id="dietSavePlanBtn" type="button" style="width:100%; background:var(--accent); color:white; font-weight:600;">Save plan</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Meal Plan Card -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <div class="dashboard-card-title">üìã Meal Plan</div>
        </div>
        <div id="dietPlanEditor" style="padding:12px;"></div>
      </div>

      <hr style="margin:14px 0; border:none; border-top:1px solid rgba(128,128,128,0.25);" />

      <details>
        <summary style="cursor:pointer; font-weight:600;">Meal library (templates)</summary>

        <form id="mealTemplateForm" style="margin-top:10px;">
          <label>
            Meal name
            <input type="text" id="mealName" placeholder="e.g. Chicken & rice" required />
          </label>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <label style="flex:1; min-width:140px;">
              Calories (per serving)
              <input type="number" id="mealCalories" min="0" step="1" required />
            </label>
            <label style="flex:1; min-width:140px;">
              Protein (g per serving)
              <input type="number" id="mealProtein" min="0" step="1" required />
            </label>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <label style="flex:1; min-width:140px;">
              Fat (g per serving) <span style="color:var(--muted); font-size:12px;">Optional</span>
              <input type="number" id="mealFat" min="0" step="0.1" placeholder="Optional" />
            </label>
            <label style="flex:1; min-width:140px;">
              Carbs (g per serving) <span style="color:var(--muted); font-size:12px;">Optional</span>
              <input type="number" id="mealCarbs" min="0" step="0.1" placeholder="Optional" />
            </label>
          </div>

          <div style="margin-top:15px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <label style="margin:0; font-weight:600;">Ingredients</label>
              <button type="button" id="addIngredientBtn" style="padding:4px 12px; font-size:13px;">+ Add Ingredient</button>
            </div>
            <div id="ingredientsList" style="display:flex; flex-direction:column; gap:8px;">
              <!-- Ingredient rows will be added here -->
            </div>
            <details style="margin-top:10px;">
              <summary style="cursor:pointer; color:var(--muted); font-size:13px;">Or use simple text format</summary>
              <textarea id="mealIngredientsText" rows="3" placeholder="Chicken breast 200g&#10;Rice 80g&#10;Broccoli 100g" style="margin-top:8px;"></textarea>
            </details>
          </div>

          <div class="btn-row">
            <button type="submit">Add meal template</button>
          </div>
        </form>

        <div id="mealTemplateList" style="margin-top:12px;"></div>
      </details>
    </div>

    <!-- LOG TAB -->
    <div id="dietTab-log" class="diet-tabpanel" role="tabpanel">
      <!-- Date & Goal Selector Card -->
      <div class="dashboard-card" style="margin-top:12px;">
        <div class="dashboard-card-header">
          <div class="dashboard-card-title">üìÖ Daily Log</div>
        </div>
        <div style="padding:16px;">
          <div style="display:flex; gap:12px; align-items:flex-end; flex-wrap:wrap; margin-bottom:12px;">
            <label style="flex:1; min-width:160px;">
              Date
              <input type="date" id="dietLogDate" required style="width:100%;" />
            </label>

            <label style="flex:1; min-width:160px;">
              Goal
              <select id="dietLogGoal" style="width:100%;">
                <option value="bulk">Bulk</option>
                <option value="cut">Cut</option>
                <option value="maintain">Maintain</option>
              </select>
            </label>
          </div>

          <div id="dietLogHint" style="color:var(--muted); font-size:13px; margin-bottom:12px;"></div>

          <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:8px;">
            <button id="dietAddExtraMealBtn" type="button" style="padding:10px; font-size:13px; font-weight:600;">+ Extra Meal</button>
            <button id="dietAddSnackBtn" type="button" data-action="add-snack" style="padding:10px; font-size:13px; font-weight:600;">+ Snack</button>
            <button id="dietAddCustomMealBtn" type="button" style="padding:10px; font-size:13px; font-weight:600;">+ Custom</button>
            <button id="dietSubmitDayBtn" type="button" style="padding:10px; font-size:13px; font-weight:600; background:var(--accent); color:white;">Submit</button>
          </div>
        </div>
      </div>

      <!-- Checklist -->
      <div id="dietChecklist" style="margin-top:12px;"></div>

      <!-- Totals Summary -->
      <div id="dietTotalsBox" style="margin-top:12px;"></div>
    </div>

    <!-- PROGRESS TAB -->
    <div id="dietTab-progress" class="diet-tabpanel" role="tabpanel">
      <!-- Progress Summary -->
      <div id="dietProgressSummary" style="margin-top:12px;"></div>

      <!-- Averages Card -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <div class="dashboard-card-title">üìä Averages</div>
        </div>
        <div style="padding:16px;">
          <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:16px;">
            <button type="button" class="diet-range-btn" data-range="7" style="flex:1; min-width:100px; padding:8px; border-radius:6px; font-size:13px; font-weight:600;">Last week</button>
            <button type="button" class="diet-range-btn" data-range="30" style="flex:1; min-width:100px; padding:8px; border-radius:6px; font-size:13px; font-weight:600;">Last month</button>
            <button type="button" class="diet-range-btn" data-range="90" style="flex:1; min-width:100px; padding:8px; border-radius:6px; font-size:13px; font-weight:600;">3 months</button>
          </div>

          <div id="dietAveragesOut"></div>
        </div>
      </div>
    </div>

    <!-- PREP & SHOP TAB -->
<div id="dietTab-prep" class="diet-tabpanel" role="tabpanel">
  <!-- Goal Selector -->
  <div class="dashboard-card" style="margin-top:12px;">
    <div style="padding:16px;">
      <label style="width:100%;">
        <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:6px; text-transform:uppercase; letter-spacing:0.5px;">Select Goal</div>
        <select id="dietPrepGoal" style="width:100%; padding:10px; border-radius:6px; border:1px solid var(--border); background:var(--surface-2);">
          <option value="bulk">Bulk</option>
          <option value="cut">Cut</option>
          <option value="maintain">Maintain</option>
        </select>
      </label>
    </div>
  </div>

  <!-- Shopping List Generator -->
  <div class="dashboard-card">
    <div class="dashboard-card-header">
      <div class="dashboard-card-title">üõí Shopping List Generator</div>
    </div>
    <div style="padding:16px;">
      <div class="meta" style="margin-bottom:12px;">Auto-calculate what to buy based on your meal plan and current inventory.</div>

      <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px;">
        <button id="generateWeeklyShoppingBtn" type="button" style="flex:1; min-width:140px; padding:10px; border-radius:6px; font-weight:600;">Generate Weekly List</button>
        <button id="generateMonthlyShoppingBtn" type="button" style="flex:1; min-width:140px; padding:10px; border-radius:6px; font-weight:600;">Generate Monthly List</button>
      </div>

      <div id="shoppingListOutput"></div>
    </div>
  </div>

  <!-- Inventory Management -->
  <details class="dashboard-card">
    <summary style="cursor:pointer; padding:16px; font-weight:700; font-size:16px; display:flex; align-items:center; gap:8px;">
      üì¶ Inventory Tracker
      <span style="font-size:14px; color:var(--muted); font-weight:400; margin-left:auto;">‚ñº</span>
    </summary>

    <div style="padding:0 16px 16px 16px; border-top:1px solid var(--border);">
      <div style="font-weight:600; margin:16px 0 12px 0; font-size:14px;">Add/Update Ingredient Stock</div>
      <form id="inventoryForm" style="display:grid; gap:10px;">
        <div style="display:grid; grid-template-columns: 2fr 1fr 1fr auto; gap:10px; align-items:end;">
          <label style="margin:0;">
            <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.5px;">Ingredient</div>
            <input type="text" id="invIngredientName" placeholder="e.g. Chicken breast" required style="width:100%; padding:10px; border-radius:6px; border:1px solid var(--border); background:var(--surface-2);" />
          </label>
          <label style="margin:0;">
            <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.5px;">Stock</div>
            <input type="number" id="invStock" min="0" step="0.1" placeholder="Amount" required style="width:100%; padding:10px; border-radius:6px; border:1px solid var(--border); background:var(--surface-2);" />
          </label>
          <label style="margin:0;">
            <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.5px;">Unit</div>
            <select id="invUnit" style="width:100%; padding:10px; border-radius:6px; border:1px solid var(--border); background:var(--surface-2);">
              <option value="g">g</option>
              <option value="kg">kg</option>
              <option value="ml">ml</option>
              <option value="l">l</option>
              <option value="whole">whole</option>
            </select>
          </label>
          <button type="submit" style="padding:10px 16px; border-radius:6px; font-weight:600; background:var(--accent); color:white;">Update</button>
        </div>
      </form>

      <div id="inventoryList" style="margin-top:16px;"></div>
    </div>
  </details>

  <!-- Meal Prep Calculator -->
  <div class="dashboard-card">
    <div class="dashboard-card-header">
      <div class="dashboard-card-title">üç≥ Sunday Prep Calculator</div>
    </div>
    <div style="padding:16px;">
      <div class="meta" style="margin-bottom:12px;">Calculate how much to cook for the week based on your plan.</div>

      <div style="display:flex; gap:10px; margin-bottom:12px; align-items:flex-end;">
        <label style="flex:1; max-width:200px; margin:0;">
          <div style="font-size:12px; font-weight:600; color:var(--muted); margin-bottom:4px; text-transform:uppercase; letter-spacing:0.5px;">Prep Days</div>
          <input type="number" id="prepDays" min="1" max="7" value="7" style="width:100%; padding:10px; border-radius:6px; border:1px solid var(--border); background:var(--surface-2);" />
        </label>
        <button id="calculatePrepBtn" type="button" style="padding:10px 16px; border-radius:6px; font-weight:600; background:var(--accent); color:white;">Calculate Prep Amounts</button>
      </div>

      <div id="prepCalculatorOutput"></div>
    </div>
  </div>

  <!-- Manual Notes (Legacy) -->
  <details class="panel" style="padding:12px; margin-bottom:12px;">
    <summary style="cursor:pointer; font-weight:700; font-size:15px;">üìù Manual Notes</summary>

    <div style="margin-top:12px;">
      <h4 style="margin:0 0 8px 0;">Monthly list (supplements, etc.)</h4>
      <div class="meta">Use this for supplements/protein powders + anything you buy monthly.</div>
      <textarea id="dietMonthlyListText" rows="6" style="width:100%; margin-top:10px;" placeholder="- Creatine (1 tub)&#10;- Whey (2 bags)&#10;- Vitamins ..."></textarea>
      <div class="btn-row" style="margin-top:10px;">
        <button id="dietSaveMonthlyBtn" type="button">Save monthly list</button>
      </div>
    </div>

    <div style="margin-top:16px;">
      <h4 style="margin:0 0 8px 0;">Sunday prep notes</h4>
      <div class="meta">Additional notes for meal prep.</div>
      <textarea id="dietSundayPrepText" rows="6" style="width:100%; margin-top:10px;" placeholder="- Portion: 200g chicken + 100g rice per lunch&#10;- Store in containers ..."></textarea>
      <div class="btn-row" style="margin-top:10px;">
        <button id="dietSaveSundayBtn" type="button">Save Sunday prep</button>
      </div>
    </div>
  </details>
</div>
    </div>
  </div>
  <!-- Diet modal (used for servings + meal selection) -->
<div id="dietModal" class="diet-modal" aria-hidden="true">
  <div id="dietModalBackdrop" class="diet-modal-backdrop"></div>
  <div class="diet-modal-sheet" role="dialog" aria-modal="true">
    <div id="dietModalTitle" class="diet-modal-title">Diet</div>

    <div id="dietModalBody"></div>

    <div class="diet-modal-actions">
      <button type="button" id="dietModalCancelBtn">Cancel</button>
      <button type="button" id="dietModalOkBtn">OK</button>
    </div>
  </div>
</div>
</div>

      </section>
<section id="view-metrics" class="lifeos-view">
  <h1 class="app-title">Metrics</h1>

  <div class="panel" style="padding:14px;">
    <h2 style="margin-top:0;">Bodyweight</h2>

    <form id="bodyweightForm">
      <label>
        Date
        <input type="date" id="bwDate" required />
      </label>

      <label>
        Weight (kg)
        <input type="number" id="bwValue" step="0.1" required />
      </label>

      <button type="submit">Add entry</button>
    </form>
  </div>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h3 style="margin-top:0;">History</h3>
    <ul id="bodyweightList"></ul>
  </div>
  <div class="panel" style="padding:14px; margin-top:12px;">
 
<!-- Body composition -->
<div class="panel" style="padding:14px; margin-top:12px;">
  <h2 style="margin-top:0;">Body composition</h2>

  <form id="bodyCompForm">
    <label>
      Date
      <input type="date" id="bcDate" required />
    </label>

    <label>
      Body fat %
      <input type="number" id="bcBodyFat" step="0.1" min="0" max="100" />
    </label>

    <label>
      Body water %
      <input type="number" id="bcBodyWater" step="0.1" min="0" max="100" />
    </label>

    <label>
      Bone metric (unknown unit)
      <input type="number" id="bcBoneMetric" step="0.1" min="0" />
    </label>

    <button type="submit">Save body comp</button>
  </form>

  <div id="leanMassHint" style="margin-top:10px; color:var(--muted); font-size:13px;"></div>
</div>

<!-- Measurements -->
<div class="panel" style="padding:14px; margin-top:12px;">
  <h2 style="margin-top:0;">Measurements (cm)</h2>

  <form id="measureForm">
    <label>
      Date
      <input type="date" id="mDate" required />
    </label>

    <label>
      Waist (cm)
      <input type="number" id="mWaist" step="0.1" min="0" />
    </label>

    <label>
      Chest (cm)
      <input type="number" id="mChest" step="0.1" min="0" />
    </label>

    <label>
      Shoulders (cm)
      <input type="number" id="mShoulders" step="0.1" min="0" />
    </label>

    <label>
      Thigh (cm)
      <input type="number" id="mThigh" step="0.1" min="0" />
    </label>

    <label>
      Biceps (cm)
      <input type="number" id="mBiceps" step="0.1" min="0" />
    </label>

    <button type="submit">Save measurements</button>
  </form>
</div>

<div class="panel" style="padding:14px; margin-top:12px;">
  <h3 style="margin-top:0;">Body comp & measurements history</h3>
  <ul id="bodyCompList"></ul>
</div>

</section>

      <section id="view-goals" class="lifeos-view">
  <h1 class="app-title">Goals</h1>

  <div class="panel" style="padding:14px;">
    <h2 style="margin-top:0;">Create goal</h2>

    <form id="goalForm">
      <label>
        Goal title
        <input type="text" id="goalTitle" placeholder="e.g. Cut to 75kg" required />
      </label>

      <label>
        Start date
        <input type="date" id="goalStartDate" required />
      </label>

      <label>
        Target date
        <input type="date" id="goalTargetDate" required />
      </label>

      <label>
        Track metric
        <select id="goalMetricSelect" required></select>
      </label>

      <label>
        Target value (optional - enables progress bar)
        <input type="number" id="goalTargetValue" placeholder="e.g. 75" step="0.1" />
      </label>

      <button type="submit">Create goal</button>
    </form>
  </div>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin-top:0;">Your goals</h2>
    <div id="goalsList"></div>
  </div>
</section>

     <section id="view-plan" class="lifeos-view">
  <h1 class="app-title">Plan</h1>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Weekly plan</h2>

    <label>
      Week starting (Monday)
      <input type="date" id="weekStart" />
    </label>

    <label>
      Filter by category
      <select id="weekCategoryFilter">
        <option value="">All categories</option>
        <option value="training">Training</option>
        <option value="health">Health</option>
        <option value="work">Work</option>
        <option value="admin">Admin</option>
        <option value="social">Social</option>
        <option value="finance">Finance</option>
        <option value="rest">Rest</option>
      </select>
    </label>

    <div class="btn-row" style="margin-top:10px;">
      <button id="prevWeekBtn" type="button">Prev week</button>
      <button id="thisWeekBtn" type="button">This week</button>
      <button id="nextWeekBtn" type="button">Next week</button>
    </div>
  </div>

  <div id="weekWrap" style="margin-top:12px;"></div>
</section>

<section id="view-work" class="lifeos-view">
  <h1 class="app-title">Work</h1>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Log work</h2>

    <form id="workLogForm">
      <label>
        Date
        <input type="date" id="workDate" required />
      </label>

      <label>
        Hours worked
        <input type="number" id="workHours" step="0.25" min="0" placeholder="e.g. 8" required />
      </label>

      <label>
        Notes (optional)
        <input type="text" id="workNote" placeholder="e.g. On-call / release / late finish" />
      </label>

      <button type="submit">Save work log</button>
    </form>

    <div class="meta" style="margin-top:10px;">
      Tip: enter hours in 0.25 steps (e.g. 7.5).
    </div>
  </div>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">This week</h2>
    <div id="workWeekSummary" style="font-size:14px;"></div>
  </div>

  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">History</h2>
    <ul id="workHistoryList"></ul>
  </div>
</section>

      <section id="view-finances" class="lifeos-view">
  <h1 class="app-title">Finances</h1>

  <!-- Overview -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Overview</h2>
    <div class="btn-row" style="margin-top:0; margin-bottom:10px;">
  <button id="moneyPeriodWeekBtn" type="button">Week</button>
  <button id="moneyPeriodMonthBtn" type="button">Month</button>
  <button id="moneyPeriodYearBtn" type="button">Year</button>
</div>
    <div id="moneyOverview" style="font-size:14px;"></div>
    <div id="moneyOverviewHint" style="margin-top:8px; color:var(--muted); font-size:13px;"></div>
  </div>

  <!-- Accounts -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">
  <span id="moneyAccountsTitle">Accounts</span>
</h2>

<div id="moneyAccountDetailHeader" style="display:none; margin-bottom:10px;">
  <button id="moneyBackToAccountsBtn" type="button">‚Üê Back to all accounts</button>
  <div style="margin-top:8px;">
    <div id="moneyAccountDetailName" style="font-weight:600;"></div>
    <div id="moneyAccountDetailBalance" class="meta"></div>
  </div>
</div>
<div id="moneyAccountCreateWrap">
    <form id="moneyAccountForm">
      <label>
        Account name
        <input type="text" id="moneyAccountName" placeholder="e.g. Current account" required />
      </label>

      <label>
        Bank / provider
        <input type="text" id="moneyAccountBank" placeholder="e.g. Revolut / Monzo / Barclays" />
      </label>

      <label>
        Type
        <select id="moneyAccountType">
          <option value="current">Current</option>
          <option value="savings">Savings</option>
          <option value="credit">Credit card</option>
          <option value="loan">Loan</option>
          <option value="cash">Cash</option>
          <option value="other">Other</option>
        </select>
      </label>

      <label>
        Starting balance (can be negative)
        <input type="number" id="moneyAccountBalance" step="0.01" placeholder="e.g. 1250 or -50" required />
      </label>

      <button type="submit">Add account</button>
    </form>

    <div style="margin-top:12px;">
      <ul id="moneyAccountsList"></ul>
    </div>
  </div>
  </div>

  <!-- Salary settings -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Salary (optional)</h2>

    <form id="moneySalaryForm">
      <label>
        Monthly salary (net)
        <input type="number" id="moneySalaryNet" step="0.01" placeholder="e.g. 2800" />
      </label>

      <label>
        Monthly deductions total (optional)
        <input type="number" id="moneySalaryDeductions" step="0.01" placeholder="e.g. 250" />
      </label>

      <label>
        Payday rule
        <select id="moneyPaydayRule">
          <option value="last_working_day">Last working day of month</option>
          <option value="last_day">Last calendar day of month</option>
        </select>
      </label>

      <button type="submit">Save salary settings</button>
    </form>

    <div class="btn-row" style="margin-top:10px;">
      <button id="moneyAddPaydayBtn" type="button">Add this month‚Äôs payday income</button>
    </div>

    <div id="moneySalaryHint" style="margin-top:8px; color:var(--muted); font-size:13px;"></div>
  </div>

  <!-- Add transaction -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">Add transaction</h2>

    <form id="moneyTxForm">
      <label>
        Date
        <input type="date" id="moneyTxDate" required />
      </label>

      <label>
        Account
        <select id="moneyTxAccount" required></select>
      </label>

      <label>
        Amount (expenses are negative)
        <input type="number" id="moneyTxAmount" step="0.01" placeholder="e.g. -12.50 or 200" required />
      </label>

      <label>
        Category
        <select id="moneyTxCategory" required></select>
      </label>

      <label>
        Essential?
        <select id="moneyTxEssential">
          <option value="essential">Essential</option>
          <option value="optional">Optional</option>
        </select>
      </label>

      <label>
        Merchant / label (optional)
        <input type="text" id="moneyTxMerchant" placeholder="e.g. Tesco / Rent / Salary" />
      </label>

      <label>
        Notes (optional)
        <input type="text" id="moneyTxNote" placeholder="Any extra context" />
      </label>

      <button type="submit">Save transaction</button>
    </form>
  </div>

  <!-- This month -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 id="moneyPeriodTitle" style="margin:0 0 10px 0;">This month</h2>

    <div id="moneyMonthSummary" style="font-size:14px;"></div>

    <div style="margin-top:10px;">
      <h3 style="margin:0 0 8px 0;">By category</h3>
      <ul id="moneyCategorySummary"></ul>
    </div>
  </div>

  <!-- History -->
  <div class="panel" style="padding:14px; margin-top:12px;">
    <h2 style="margin:0 0 10px 0;">History</h2>
    <ul id="moneyTxList"></ul>
  </div>
</section>

      <section id="view-journal" class="lifeos-view">
        <h1 class="app-title">Journal</h1>
        <p>Placeholder.</p>
      </section>

      <section id="view-people" class="lifeos-view">
        <h1 class="app-title">People</h1>
        <p>Placeholder.</p>
      </section>
    </main>

    <!-- Your existing scripts (unchanged order) -->
   <script src="workouts.js"></script>
<script src="app.js"></script>

<script src="db.js"></script>
<script src="lifeos-export.js"></script>
<script src="lifeos.js"></script>

<script src="metrics.js"></script>
<script src="diet-templates.js"></script>
<script src="goals.js"></script>
<script src="work.js"></script>
<script src="finance.js"></script>
<script src="today.js"></script>
<script src="plan.js"></script>
<script src="shell.js"></script>

<!-- Service Worker Registration -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then((registration) => {
          console.log('[App] Service Worker registered:', registration.scope);
        })
        .catch((error) => {
          console.error('[App] Service Worker registration failed:', error);
        });
    });
  }
</script>
</html>
